---
title: "Survival Analysis of Post-Myocardial Infarction Patients"
author: "Alvein, Orr, Pham"
date: "5/22/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.height=4.5, fig.width=6)

library(readxl)
library(knitr)
library(tidyverse)
library(dplyr)
library(kableExtra)
library(survival)
library(survminer)
library(ggplot2)
```
# Abstract

## Background
The rates of myocardial infarction is becoming an increasing common occurence in the United States. As medical knowledge and techniques improve to meet need of infarction episode, so does the need to understand the survivbility of patients who have survived such episodes.

## Objectives
Our goal is to provide detailed survival statistics of post-myocardial infarction patients as well as provide an accurate regression model to best prediction of survival outcomes of a single year following an infarction episode.

## Methods
Data from 133 post-myocardial infarction patients measure the time in months until death in a one year monitoring period of follow-up. We use a combination of nonparametric (Kaplan-Meier) and parametric methods (Weibull/Cox PH) to determine estimates of survival among gender and myocardial strata (contraction depth, muscular activity, ). We consider a slew of statistical and graphical results before determining the most appropriate method of modeling.

## Results
Out of all of our methods, we have determined that [] is the most appropriate model for prediction of patient survival. We have AIC values of. We have BIC values. Thus, this model is the best.

## Conclusion
[summary statistics]
[review of our model + specific surval rates]


# Introduction

Heart disease has become the leader cause of death among the US population among a majority of all racial and ethnic groups (Heron 2019). Myocardial infarctions are becoming largely common among U.S. populations. The number of myocardial infarctions are remarkedly increased from [start date] to [end date] by [x] amount (add citation). In 2015, approximately 23% of all fatalities in the United States was related to some degree of heart disease (cdc. cite please). Unsurprisingly, clinical studies have shown harmful symptoms in post-infarction survival patients. Our obtained dataset to examine the tangible difference in survability rates from the course of year following an infarction episode.

By applying survival analysis techniques to this data set, we seek to achieve improved understanding of the characteristics exhibited by patients in a one year post-infarction interval.We also propose a model to better predict the probability of a survival of patients based on these variable characteristics.


## Dataset
We have obtained our data set from Kaggle. The data set contains 131 of observations and records 8 variables. It should be noted that two patients data were removed as there was no recorded months survival date.

Below is a table summary of each table header variable label and a definition of that variable.

```{r Dataset.summary, echo=FALSE}
df.sum <- data.frame(read_excel("df.sum.xlsx"))
kable(df.sum, caption = "Dataset Variable Labels")
```

Since the time of infartion varies, some patients were followed for less than a year. This provides a clear censoring and truncation provide. We will address this concern in detail in the later in this section. It should be noted that we have a slew of missing values. Since a single patient has shown as missing, we have opted to impute the values for this data row. With this in mind, our predictive and summary models will have less than ideal accuracy.

The full dataset is available in the appendix of this paper.


# Methodology

## Censoring
Right censored: this study has a fixed start and end date. Some patients start the study midway through the study and thus, we cannot measure the total little length.

## Imputation
There are several missing values in the data set. The variables we chose to more 
## Summary statistics
Over the course of the study, there is a 
## Kaplan-Meier
We conduct nonparametric Kaplan-Meier fit on our data over multiple strata. We first conduct a fit over all patients in regards to censoring. Then we work on gender groups, age, and general ventriculular condition. A survival function can be defined as:

[insert latex equation for survival function, with censored values]

## Weibull Fits (+Cox PH)

## Log-Normal



# Results
## Table of Summary Statistics

```{r stats.summary, echo=FALSE}

```

## KM Curve & Hazard

### Survival Curves
#### KM Overall
```{r km.all, fig.align='center', echo=FALSE}

df <- data.frame(read_excel("df.xlsx"))
s.df = Surv(df$Survival,df$Status)
km.all = survfit(s.df~1,type="kaplan-meier", data = df)
ggsurvplot(km.all, 
           palette = "#2E9FDF", 
           conf.int = TRUE, 
           title="Post-Myocardial Infarction Survival", 
           subtitle="All Groups",
           font.title=c(12,"bold.italic"),
           font.subtitle = c(10,"italic"),
           font.x = c(9, "bold.italic"),
           font.y = c(9, "bold.italic"),
           ylab="Surival Proportion", 
           xlab="Time to Death (Months)",
           surv.median.line = "hv",
           legend.title = "Groups",
           legend.labs = "All")
```

Here is the survival curve for all groups within our dataset. We see that a majority of our censored values have very short survival times. This is very intuitive given to our limited interval study time of a single year. We clearly see a median survival time of approximately 29 weeks.

#### KM Age
```{r km., fig.align='center', echo=FALSE}

km.age = survfit(s.df~Age.Strata, type="kaplan-meier", data = df)
ggsurvplot(km.age, 
           palette = c("darkcyan","darkgoldenrod3","darkorange3"), 
           title="Post-Myocardial Infarction Survival", 
           subtitle="Stratified by Age Group",
           font.title=c(12,"bold.italic"),
           font.subtitle = c(10,"italic"),
           font.x = c(9, "bold.italic"),
           font.y = c(9, "bold.italic"),
           ylab="Surival Proportion", 
           xlab="Time to Death (Months)",
           surv.median.line = "hv",
           legend.title = "Groups",
           legend.labs = c("< 45 Year","45 - 64 Years","\u2265 65 Years"))

```

Brief fitting of stratification survival by age shows some surviving results. The youngest group has the highest survival to the median, and then see a sharp decrease in survivability after the median time of 30 months has past. In contrast, our two older groups have relatively similar patterns of survivability through the median. Given that younger individuals generally have healthier hearts, patients that experience a myocardial infarction at a younger age are likely to have a slew of other complication

#### KM P.Effusion
```{r km.effusion, fig.align='center', echo=FALSE}

km.effusion = survfit(s.df~P.Effusion, type="kaplan-meier", data = df)
ggsurvplot(km.effusion, 
           palette = c("darkcyan","darkgoldenrod3"), 
           title="Post-Myocardial Infarction Survival", 
           subtitle="Stratified by Presence of Pericardial Effusion",
           font.title=c(12,"bold.italic"),
           font.subtitle = c(10,"italic"),
           font.x = c(9, "bold.italic"),
           font.y = c(9, "bold.italic"),
           ylab="Surival Proportion", 
           xlab="Time to Death (Months)",
           surv.median.line = "hv",
           legend.title = "Groups",
           legend.labs = c("Present","Absent"))

```

#### KM Ventricular Activity
```{r km.plot, echo=FALSE}

```

### Hazard Plots

## Weibull Curve

```{r wb.plot, echo=FALSE}

```

## Cox Proportional Hazard

```{r coxph.plot, echo=FALSE}

```

## Model Diagnostics

### AIC, BIC, and Confidence Intervals

```{r diagnostic.table, echo=FALSE}

```

### Residual Analysis/QQ Plot

```{r diagnostic.resid, echo=FALSE}

```

```{r diagnostic.qqplot, echo=FALSE}

```

# Discussion

# References
Heron, M. Deaths: Leading causes for 2017 pdf icon[PDF – 3 M]. National Vital Statistics Reports;68(6). Accessed November 19, 2019.

Salzberg, S. (1988). Exemplar-based learning: Theory and implementation (Technical Report TR-10-88). Harvard University, Center for Research in Computing Technology, Aiken Computation Laboratory (33 Oxford Street; Cambridge, MA 02138).

Kan, G., Visser, C., Kooler, J., & Dunning, A. (1986). Short and long term predictive value of wall motion score in acute myocardial infarction. British Heart Journal, 56, 422-427.

Fryar CD, Chen T-C, Li X. Prevalence of uncontrolled risk factors for cardiovascular disease: United States, 1999–2010 pdf icon[PDF-494K]. NCHS data brief, no. 103. Hyattsville, MD: National Center for Health Statistics; 2012. Accessed May 9, 2019.


# Appendix

## Dataset

```{r Dataset.actual, echo=FALSE, results='asis'}

kable(df, caption = "Dataset")
```


## R Code